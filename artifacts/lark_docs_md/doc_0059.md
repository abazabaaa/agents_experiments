https://lark-parser.readthedocs.io/en/stable/examples/advanced/create_ast.html

- [Home](https://lark-parser.readthedocs.io/en/stable/index.html)
- [Examples for Lark](https://lark-parser.readthedocs.io/en/stable/examples/index.html)
- [Advanced Examples](https://lark-parser.readthedocs.io/en/stable/examples/advanced/index.html)
- Creating an AST from the parse tree
- [Edit on GitHub](https://github.com/lark-parser/lark/blob/acfe33d943a1310f3ca26145eb2896bc5c4955c9/docs/examples/advanced/create_ast.rst)

[Previous](https://lark-parser.readthedocs.io/en/stable/examples/advanced/python_parser.html "Grammar-complete Python Parser") [Next](https://lark-parser.readthedocs.io/en/stable/examples/advanced/error_reporting_earley.html "Example-Driven Error Reporting")

* * *

Note

[Go to the end](https://lark-parser.readthedocs.io/en/stable/examples/advanced/create_ast.html#sphx-glr-download-examples-advanced-create-ast-py)
to download the full example code

# Creating an AST from the parse tree [](https://lark-parser.readthedocs.io/en/stable/examples/advanced/create_ast.html\#creating-an-ast-from-the-parse-tree "Permalink to this heading")

> This example demonstrates how to transform a parse-tree into an AST using lark.ast\_utils.
>
> create\_transformer() collects every subclass of Ast subclass from the module,
> and creates a Lark transformer that builds the AST with no extra code.
>
> This example only works with Python 3.

```
import sys
from typing import List
from dataclasses import dataclass

from lark import Lark, ast_utils, Transformer, v_args
from lark.tree import Meta

this_module = sys.modules[__name__]

#
#   Define AST
#
class _Ast(ast_utils.Ast):
    # This will be skipped by create_transformer(), because it starts with an underscore
    pass

class _Statement(_Ast):
    # This will be skipped by create_transformer(), because it starts with an underscore
    pass

@dataclass
class Value(_Ast, ast_utils.WithMeta):
    "Uses WithMeta to include line-number metadata in the meta attribute"
    meta: Meta
    value: object

@dataclass
class Name(_Ast):
    name: str

@dataclass
class CodeBlock(_Ast, ast_utils.AsList):
    # Corresponds to code_block in the grammar
    statements: List[_Statement]

@dataclass
class If(_Statement):
    cond: Value
    then: CodeBlock

@dataclass
class SetVar(_Statement):
    # Corresponds to set_var in the grammar
    name: str
    value: Value

@dataclass
class Print(_Statement):
    value: Value

class ToAst(Transformer):
    # Define extra transformation functions, for rules that don't correspond to an AST class.

    def STRING(self, s):
        # Remove quotation marks
        return s[1:-1]

    def DEC_NUMBER(self, n):
        return int(n)

    @v_args(inline=True)
    def start(self, x):
        return x

#
#   Define Parser
#

parser = Lark("""
    start: code_block

    code_block: statement+

    ?statement: if | set_var | print

    if: "if" value "{" code_block "}"
    set_var: NAME "=" value ";"
    print: "print" value ";"

    value: name | STRING | DEC_NUMBER
    name: NAME

    %import python (NAME, STRING, DEC_NUMBER)
    %import common.WS
    %ignore WS
    """,
    parser="lalr",
)

transformer = ast_utils.create_transformer(this_module, ToAst())

def parse(text):
    tree = parser.parse(text)
    return transformer.transform(tree)

#
#   Test
#

if __name__ == '__main__':
    print(parse("""
        a = 1;
        if a {
            print "a is 1";
            a = 2;
        }
    """))

```

**Total running time of the script:** (0 minutes 0.000 seconds)

[`Download Python source code: create_ast.py`](https://lark-parser.readthedocs.io/en/stable/_downloads/bfeb22cff3ae6c24841aad8c5a95d047/create_ast.py)

[`Download Jupyter notebook: create_ast.ipynb`](https://lark-parser.readthedocs.io/en/stable/_downloads/08132b45db8ea39c7a8efd8acc048de2/create_ast.ipynb)

[Gallery generated by Sphinx-Gallery](https://sphinx-gallery.github.io/)

Versions[latest](https://lark-parser.readthedocs.io/en/latest/examples/advanced/create_ast.html)**[stable](https://lark-parser.readthedocs.io/en/stable/examples/advanced/create_ast.html)**Downloads[PDF](https://lark-parser.readthedocs.io/_/downloads/en/stable/pdf/)[HTML](https://lark-parser.readthedocs.io/_/downloads/en/stable/htmlzip/)[EPUB](https://lark-parser.readthedocs.io/_/downloads/en/stable/epub/)On Read the Docs[Project Home](https://app.readthedocs.org/projects/lark-parser/?utm_source=lark-parser&utm_content=flyout)[Builds](https://app.readthedocs.org/projects/lark-parser/builds/?utm_source=lark-parser&utm_content=flyout)Search

* * *

[Addons documentation](https://docs.readthedocs.io/page/addons.html?utm_source=lark-parser&utm_content=flyout) ― Hosted by
[Read the Docs](https://about.readthedocs.com/?utm_source=lark-parser&utm_content=flyout)