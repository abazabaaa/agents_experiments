https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html

- [Home](https://lark-parser.readthedocs.io/en/stable/index.html)
- [Examples for Lark](https://lark-parser.readthedocs.io/en/stable/examples/index.html)
- [Grammar Composition](https://lark-parser.readthedocs.io/en/stable/examples/composition/index.html)
- Grammar Composition
- [Edit on GitHub](https://github.com/lark-parser/lark/blob/acfe33d943a1310f3ca26145eb2896bc5c4955c9/docs/examples/composition/main.rst)

[Previous](https://lark-parser.readthedocs.io/en/stable/examples/composition/eval_csv.html "<no title>") [Next](https://lark-parser.readthedocs.io/en/stable/examples/grammars/index.html "Example Grammars")

* * *

Note

[Go to the end](https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html#sphx-glr-download-examples-composition-main-py)
to download the full example code

# Grammar Composition [](https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html\#grammar-composition "Permalink to this heading")

This example shows how to do grammar composition in Lark, by creating a new
file format that allows both CSV and JSON to co-exist.

1. We define `storage.lark`, which imports both `csv.lark` and `json.lark`,


> and allows them to be used one after the other.
>
> In the generated tree, each imported rule/terminal is automatically prefixed (with `json__` or [\`\`](https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html#id1) [csv\_\_](https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html#id3)),
> which creates an implicit namespace and allows them to coexist without collisions.

2. We merge their respective transformers (unaware of each other) into a new base transformer.
The resulting transformer can evaluate both JSON and CSV in the parse tree.


> The methods of each transformer are renamed into their appropriate namespace, using the given prefix.
> This approach allows full re-use: the transformers don’t need to care if their grammar is used directly,
> or being imported, or who is doing the importing.

```
from pathlib import Path
from lark import Lark
from json import dumps
from lark.visitors import Transformer, merge_transformers

from eval_csv import CsvTreeToPandasDict
from eval_json import JsonTreeToJson

__dir__ = Path(__file__).parent

class Storage(Transformer):
    def start(self, children):
        return children

storage_transformer = merge_transformers(Storage(), csv=CsvTreeToPandasDict(), json=JsonTreeToJson())

parser = Lark.open("storage.lark", rel_to=__file__)

def main():
    json_tree = parser.parse(dumps({"test": "a", "dict": { "list": [1, 1.2] }}))
    res = storage_transformer.transform(json_tree)
    print("Just JSON: ", res)

    csv_json_tree = parser.parse(open(__dir__ / 'combined_csv_and_json.txt').read())
    res = storage_transformer.transform(csv_json_tree)
    print("JSON + CSV: ", dumps(res, indent=2))

if __name__ == "__main__":
    main()

```

**Total running time of the script:** (0 minutes 0.000 seconds)

[`Download Python source code: main.py`](https://lark-parser.readthedocs.io/en/stable/_downloads/98afe2f1c3b9485fcb8bdeebbbf0234f/main.py)

[`Download Jupyter notebook: main.ipynb`](https://lark-parser.readthedocs.io/en/stable/_downloads/9edfb38ad3bc19fc2b92c728275b9008/main.ipynb)

[Gallery generated by Sphinx-Gallery](https://sphinx-gallery.github.io/)

Versions[latest](https://lark-parser.readthedocs.io/en/latest/examples/composition/main.html)**[stable](https://lark-parser.readthedocs.io/en/stable/examples/composition/main.html)**Downloads[PDF](https://lark-parser.readthedocs.io/_/downloads/en/stable/pdf/)[HTML](https://lark-parser.readthedocs.io/_/downloads/en/stable/htmlzip/)[EPUB](https://lark-parser.readthedocs.io/_/downloads/en/stable/epub/)On Read the Docs[Project Home](https://app.readthedocs.org/projects/lark-parser/?utm_source=lark-parser&utm_content=flyout)[Builds](https://app.readthedocs.org/projects/lark-parser/builds/?utm_source=lark-parser&utm_content=flyout)Search

* * *

[Addons documentation](https://docs.readthedocs.io/page/addons.html?utm_source=lark-parser&utm_content=flyout) ― Hosted by
[Read the Docs](https://about.readthedocs.com/?utm_source=lark-parser&utm_content=flyout)