https://lark-parser.readthedocs.io/en/stable/_downloads/c1123c2587eda70bc64752df00c577b1/py3to2.ipynb

```
{
  "cells": [\
    {\
      "cell_type": "markdown",\
      "metadata": {},\
      "source": [\
        "\n# Python 3 to Python 2 converter (tree templates)\n\nThis example demonstrates how to translate between two trees using tree templates.\nIt parses Python 3, translates it to a Python 2 AST, and then outputs the result as Python 2 code.\n\nUses reconstruct_python.py for generating the final Python 2 code.\n"\
      ]\
    },\
    {\
      "cell_type": "code",\
      "execution_count": null,\
      "metadata": {\
        "collapsed": false\
      },\
      "outputs": [],\
      "source": [\
        "from lark import Lark\nfrom lark.tree_templates import TemplateConf, TemplateTranslator\n\nfrom lark.indenter import PythonIndenter\nfrom reconstruct_python import PythonReconstructor\n\n\n#\n# 1. Define a Python parser that also accepts template vars in the code (in the form of $var)\n#\nTEMPLATED_PYTHON = r\"\"\"\n%import python (single_input, file_input, eval_input, atom, var, stmt, expr, testlist_star_expr, _NEWLINE, _INDENT, _DEDENT, COMMENT, NAME)\n\n%extend atom: TEMPLATE_NAME -> var\n\nTEMPLATE_NAME: \"$\" NAME\n\n?template_start: (stmt | testlist_star_expr _NEWLINE)\n\n%ignore /[\\t \\f]+/          // WS\n%ignore /\\\\[\\t \\f]*\\r?\\n/   // LINE_CONT\n%ignore COMMENT\n\"\"\"\n\nparser = Lark(TEMPLATED_PYTHON, parser='lalr', start=['single_input', 'file_input', 'eval_input', 'template_start'], postlex=PythonIndenter(), maybe_placeholders=False)\n\n\ndef parse_template(s):\n    return parser.parse(s + '\\n', start='template_start')\n\ndef parse_code(s):\n    return parser.parse(s + '\\n', start='file_input')\n\n\n#\n# 2. Define translations using templates (each template code is parsed to a template tree)\n#\n\npytemplate = TemplateConf(parse=parse_template)\n\ntranslations_3to2 = {\n    'yield from $a':\n\t    'for _tmp in $a: yield _tmp',\n\n    'raise $e from $x':\n    \t'raise $e',\n\n    '$a / $b':\n\t    'float($a) / $b',\n}\ntranslations_3to2 = {pytemplate(k): pytemplate(v) for k, v in translations_3to2.items()}\n\n#\n# 3. Translate and reconstruct Python 3 code into valid Python 2 code\n#\n\npython_reconstruct = PythonReconstructor(parser)\n\ndef translate_py3to2(code):\n\ttree = parse_code(code)\n\ttree = TemplateTranslator(translations_3to2).translate(tree)\n\treturn python_reconstruct.reconstruct(tree)\n\n\n#\n# Test Code\n#\n\n_TEST_CODE = '''\nif a / 2 > 1:\n    yield from [1,2,3]\nelse:\n    raise ValueError(a) from e\n\n'''\n\ndef test():\n\tprint(_TEST_CODE)\n\tprint('   ----->    ')\n\tprint(translate_py3to2(_TEST_CODE))\n\nif __name__ == '__main__':\n\ttest()"\
      ]\
    }\
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    },
    "language_info": {
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "file_extension": ".py",
      "mimetype": "text/x-python",
      "name": "python",
      "nbconvert_exporter": "python",
      "pygments_lexer": "ipython3",
      "version": "3.7.17"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
```