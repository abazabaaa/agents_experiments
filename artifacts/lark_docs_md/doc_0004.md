https://lark-parser.readthedocs.io/en/stable/_downloads/9edfb38ad3bc19fc2b92c728275b9008/main.ipynb

```
{
  "cells": [\
    {\
      "cell_type": "markdown",\
      "metadata": {},\
      "source": [\
        "\n# Grammar Composition\n\nThis example shows how to do grammar composition in Lark, by creating a new\nfile format that allows both CSV and JSON to co-exist.\n\n1) We define ``storage.lark``, which imports both ``csv.lark`` and ``json.lark``,\n  and allows them to be used one after the other.\n\n  In the generated tree, each imported rule/terminal is automatically prefixed (with ``json__`` or ``csv__),\n  which creates an implicit namespace and allows them to coexist without collisions.\n\n2) We merge their respective transformers (unaware of each other) into a new base transformer.\n   The resulting transformer can evaluate both JSON and CSV in the parse tree.\n\n  The methods of each transformer are renamed into their appropriate namespace, using the given prefix.\n  This approach allows full re-use: the transformers don't need to care if their grammar is used directly,\n  or being imported, or who is doing the importing.\n"\
      ]\
    },\
    {\
      "cell_type": "code",\
      "execution_count": null,\
      "metadata": {\
        "collapsed": false\
      },\
      "outputs": [],\
      "source": [\
        "from pathlib import Path\nfrom lark import Lark\nfrom json import dumps\nfrom lark.visitors import Transformer, merge_transformers\n\nfrom eval_csv import CsvTreeToPandasDict\nfrom eval_json import JsonTreeToJson\n\n__dir__ = Path(__file__).parent\n\nclass Storage(Transformer):\n    def start(self, children):\n        return children\n\nstorage_transformer = merge_transformers(Storage(), csv=CsvTreeToPandasDict(), json=JsonTreeToJson())\n\nparser = Lark.open(\"storage.lark\", rel_to=__file__)\n\ndef main():\n    json_tree = parser.parse(dumps({\"test\": \"a\", \"dict\": { \"list\": [1, 1.2] }}))\n    res = storage_transformer.transform(json_tree)\n    print(\"Just JSON: \", res)\n\n    csv_json_tree = parser.parse(open(__dir__ / 'combined_csv_and_json.txt').read())\n    res = storage_transformer.transform(csv_json_tree)\n    print(\"JSON + CSV: \", dumps(res, indent=2))\n\n\nif __name__ == \"__main__\":\n    main()"\
      ]\
    }\
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    },
    "language_info": {
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "file_extension": ".py",
      "mimetype": "text/x-python",
      "name": "python",
      "nbconvert_exporter": "python",
      "pygments_lexer": "ipython3",
      "version": "3.7.17"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
```